@main {

<div ng-controller="ClinicalRecordCtrl">

	<h1 id="homeTitle">Pacientes</h1>
	
	<div class="alert-message block-message success">{{message}}</div>

	<div class="well">
		<h2>Adicionar um paciente</h2> <br />

		<form class="ng-pristine ng-valid">
		   	<fieldset >
    			<label for="name">Medico:</label>
    			<div class="input">
    				<select ng-options="item.typeexamination.description for item in typeexaminations"   ng-model="typeexamination"></select>
		    	</div>
		    	<br />
		    	<label for="name">Descrição:</label>
    			<div class="input">
				    <input type = "text" ng-model = "description" />
		    	</div>
	    	</fieldset>
		  	<div class="actions">
	    		<input type="submit" value="Adicionar" class="btn success" ng-click="save()" />
   			</div>
    	</form>
	
 	</div>
	
	<h2>Lista de pacientes</h2> <br />
	
	<table class="computers zebra-striped" >
		<thead>
			<tr>
				<td>Id</td>
				<td>Medico</td>
				<td>Descrição</td>
			</tr>
		</thead>
		<tbody >
			<tr ng-repeat="item in data">
	   			<td ng-model="id">{{item.id}}</td>
	   	        <td> {{item.medico.name}} </td>
	   	        <td> {{item.descrição}} </td>
             </tr>
	        </tbody>
	    </table>

</div>	    
	<script type="text/javascript">
	
		function ClinicalRecordCtrl ($scope, $http) {

			$scope.save = function(){
			
				var data = { id : null , name : $scope.name, endereco : $scope.endereco, cpf : $scope.cpf }
				
				var _url = "@routes.PatientController.save()";
				
				$http.post(_url, JSON.stringify(data)).success(
						function(data, status, headers, config) {
							$scope.list();
							$scope.clear();
							$scope.message = data.message;
				})
				. error(function(data, status, headers, config) {
					
					$scope.message = "Erro ao chamar a url " + _url + " status " + status;
					
				});
			}
			

			$scope.list = function () {
				
				var _url = "@routes.PatientController.list()";
				
				$http({method: 'GET', url: _url}).success(function(data, status, headers, config) {
					
			  		$scope.data = data.data;

				}).error(function(data, status, headers, config) {

					console.log(status);
			  	});


		
			}
			
			$scope.clear = function () {
				$scope.name = '';
				$scope.cpf = '';
				$scope.endereco = '';
				$scope.message = '';
			}
			
			$scope.list();
		
		}
		
    </script>
}
